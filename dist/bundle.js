(()=>{"use strict";var t={719:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Object3d=void 0;const n=i(79);e.Object3d=class{constructor(t,e,i,n){this.trianglesOriginal=t,this.triangles=this.copyTriangles(t),this.position=e,this.rotation=i,this.color=n}copyTriangles(t){let e=[];for(let i=0;i<t.length;i++){let s=[];for(let e=0;e<t[i].length;e++)s.push(new n.Vector3d(t[i][e].x,t[i][e].y,t[i][e].z));e.push(s)}return e}update(){this.triangles=this.copyTriangles(this.trianglesOriginal),this.rotate(),this.translate()}rotate(){let t=this.rotation.y,e=this.rotation.x,i=this.rotation.z;var n=Math.cos(i),s=Math.sin(i),r=Math.cos(t),o=Math.sin(t),h=Math.cos(e),l=Math.sin(e),a=n*r,c=n*o*l-s*h,d=n*o*h+s*l,g=s*r,u=s*o*l+n*h,p=s*o*h-n*l,w=-o,m=r*l,x=r*h;for(let t=0;t<this.triangles.length;t++)for(let e=0;e<this.triangles[t].length;e++){var y=this.triangles[t][e].x,b=this.triangles[t][e].y,f=this.triangles[t][e].z;this.triangles[t][e].x=a*y+c*b+d*f,this.triangles[t][e].y=g*y+u*b+p*f,this.triangles[t][e].z=w*y+m*b+x*f}}translate(){for(let t=0;t<this.triangles.length;t++)for(let e=0;e<this.triangles[t].length;e++)this.triangles[t][e]=this.translate3dPoint(this.triangles[t][e],this.position)}translate3dPoint(t,e){return t.x+=e.x,t.y+=e.y,t.z+=e.z,t}}},943:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Pixel=void 0;class i{constructor(t,e,i){this.r=t,this.g=e,this.b=i,this.indexFirstObjectHit=-1,this.indexFirstTriangleHit=-1,this.allSamplesHitSameObject=!1}copy(){let t=new i(this.r,this.g,this.b);return t.indexFirstObjectHit=this.indexFirstObjectHit,t.indexFirstTriangleHit=this.indexFirstTriangleHit,t.allSamplesHitSameObject=this.allSamplesHitSameObject,t}isEqual(t){return null!==t&&this.r==t.r&&this.g==t.g&&this.b==t.b}calculateLuminance(){return.299*this.r+.587*this.g+.114*this.b}}e.Pixel=i},180:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RayCastingEngine=void 0;const n=i(943),s=i(79);e.RayCastingEngine=class{constructor(){this.width=1,this.height=1,this.objects=[],this.lights=[],this.pixels=[],this.pixelsLastFrame=[],this.lastWindowWidth=1,this.lastWindowHeight=1,this.lastFrameMs=Date.now()}setSizes(t,e){(this.width!=t||this.height!=e)&&(this.pixels=new Array(t*e).fill(null),this.pixelsLastFrame=new Array(t*e).fill(null)),this.width=t,this.height=e}getEllapsedMsSinceLastFrame(){const t=Date.now(),e=t-this.lastFrameMs;return this.lastFrameMs=t,e}addObject(t){this.objects.push(t)}addLight(t){this.lights.push(t)}enableLight(t,e){t>=this.lights.length||(this.lights[t].enabled=e)}update(t,e){this.savePixelsFromLastFrame(),this.pixels.fill(null);for(let t=0;t<this.objects.length;t++)0==t?this.objects[t].rotation.y+=.0023*e:1==t?(this.objects[t].rotation.x+=.0041*e,this.objects[t].rotation.z+=.027*e):(this.objects[t].rotation.z-=.0043*e,this.objects[t].rotation.y+=.0028*e),this.objects[t].update();for(let e=0;e<this.height;e+=2)for(let i=e%4==0?0:1;i<this.width;i+=2){let n=this.coordsToIndex(i,e);this.pixels[n]=this.calculatePixelWithMultisampling(i,e,t.multisampling)}for(let e=0;e<this.height;e+=1)for(let i=0;i<this.width;i+=1){let n=this.coordsToIndex(i,e);null===this.pixels[n]&&(t.optimization&&(this.pixels[n]=this.calculatePixelWithInterpolation(i,e,0)),null===this.pixels[n]&&(this.pixels[n]=this.calculatePixelWithMultisampling(i,e,t.multisampling)))}}savePixelsFromLastFrame(){for(let t=0;t<this.pixels.length;t++){const e=this.pixels[t];if(null===e)break;this.pixelsLastFrame[t]=e.copy()}}coordsToIndex(t,e){return e*this.width+t}getPixels(){return this.pixels}calculatePixelWithInterpolation(t,e,i){if(t==this.width-1||e==this.height-1||0==t||0==e)return null;const s=[0,1,2];s.includes(i)||(console.log("Interpolation can only be calculated with options "+s.join(", ")+"samples. Using left and right as fallback."),i=0);const r=[];0!=i&&2!=i||(r.push([t+1,e]),r.push([t-1,e])),1!=i&&2!=i||(r.push([t,e+1]),r.push([t,e-1]));const o=new n.Pixel(0,0,0),h=[],l=[];for(let t of r){let e=this.coordsToIndex(t[0],t[1]);if(null===this.pixels[e])return null;if(!this.pixels[e].allSamplesHitSameObject)return null;h.push(this.pixels[e].indexFirstObjectHit),l.push(this.pixels[e].indexFirstTriangleHit),o.r+=this.pixels[e].r/r.length,o.g+=this.pixels[e].g/r.length,o.b+=this.pixels[e].b/r.length}const a=h.every(((t,e,i)=>t===i[0])),c=l.every(((t,e,i)=>t===i[0]));return a&&c?o:null}calculatePixelWithMultisampling(t,e,i){let s=[1,2,4,8];if(s.includes(i)||(console.log("Multisampling can only be calculated with "+s.join(", ")+"samples. Using no-multisampling as fallback."),i=1),1==i){const i=this._calculatePixel(t,e);return i.allSamplesHitSameObject=!0,i}let r=[{x:-.25,y:-.25},{x:.25,y:.25}];i>=4&&(r.push({x:-.25,y:.25}),r.push({x:.25,y:-.25})),i>=8&&(r.push({x:-.5,y:.5}),r.push({x:.5,y:-.5}));const o=new n.Pixel(0,0,0),h=[],l=[];for(let i of r){let n=this._calculatePixel(t+i.x,e+i.y);o.r+=n.r/r.length,o.g+=n.g/r.length,o.b+=n.b/r.length,h.push(n.indexFirstObjectHit),l.push(n.indexFirstTriangleHit)}let a=h.every(((t,e,i)=>t===i[0])),c=l.every(((t,e,i)=>t===i[0]));return o.allSamplesHitSameObject=a&&c,o.indexFirstObjectHit=h[0],o.indexFirstTriangleHit=l[0],o}_calculatePixel(t,e){const i=.333*this.width;let r=new s.Vector3d(t-this.width/2,e-this.height/2,i),o=new s.Vector3d(0,0,0),h=this.getIntersectionsWithObjects(o,r.subtract(o));const l=this.getClosestIntersection(h);if(null===l)return new n.Pixel(0,0,0);const a=l.point.scale(1),c=l.triangle;let d=[];this.lights.forEach((t=>{if(!t.enabled)return;let e=a.subtract(t.position),i=this.getIntersectionsWithObjects(t.position,e),n=this.getClosestIntersection(i);if(null!==n&&n.point.isAtSamePlaceAs(a)){let i=e.getAngleToTriangle(c);d.push({angle:i,intensity:t.intensity})}}));let g=1;d.forEach((t=>{let e=t.angle;e=Math.abs(e),e>90&&(e=90-(e-90)),g+=e/90*t.intensity}));const u=this.objects[l.objectIndex].color,p=new n.Pixel(u.r/(l.distance/50)*g,u.g/(l.distance/50)*g,u.b/(l.distance/50)*g);return p.indexFirstObjectHit=l.objectIndex,p.indexFirstTriangleHit=l.triangleIndex,p}getClosestIntersection(t){let e=1/0,i=null;return t.forEach(((t,n)=>{t.distance<e&&(i=t,e=t.distance)})),i}getIntersectionsWithObjects(t,e){let i=[];return this.objects.forEach(((n,s)=>{n.triangles.forEach(((n,r)=>{let o=e.getIntersectionPointWithTriangle(n,t);null!==o&&i.push({point:o,distance:o.getDistanceFromOtherVector(t),objectIndex:s,triangle:n,triangleIndex:r})}))})),i}}},929:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RayCastingJs=void 0,e.RayCastingJs=class{constructor(t,e){this.deltaTimeHistory=[],this.renderers={},this.config={height:1,width:1,multisampling:1,optimization:!1,renderer:"",lightLeft:!1,lightTop:!1,lightRight:!1,lightBottom:!1},this.engine=t,this.loadConfig(e),this.engine.setSizes(this.config.width,this.config.height),this.lastFrameMilliseconds=Date.now()}loadConfig(t){if(this.config.renderer!=t.renderer)for(const e in this.renderers)e==t.renderer?this.renderers[e].enable():this.renderers[e].disable();this.engine.enableLight(0,t.lightRight),this.engine.enableLight(1,t.lightTop),this.engine.enableLight(2,t.lightLeft),this.engine.enableLight(3,t.lightBottom),this.config=t,this.engine.setSizes(this.config.width,this.config.height),this.onResize()}addRenderer(t,e){this.renderers[e]=t}update(){const t=Date.now(),e=t-this.lastFrameMilliseconds;this.addDeltaTimeToHistory(e),this.engine.update(this.config,e/(1e3/60)),this.lastFrameMilliseconds=t}onResize(){0!=Object.keys(this.renderers).length&&this.renderers[this.config.renderer].onResize(this.config.width)}draw(){this.renderers[this.config.renderer].render(this.engine.getPixels(),this.engine.width)}addDeltaTimeToHistory(t){this.deltaTimeHistory.length>=5&&this.deltaTimeHistory.shift(),this.deltaTimeHistory.push(t)}getFps(){const t=this.deltaTimeHistory.reduce(((t,e)=>t+e),0)/this.deltaTimeHistory.length;return Math.round(1e3/t)}}},768:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AsciiRenderer=void 0,e.AsciiRenderer=class{constructor(t){this.getFontSizeToFitScreen=t=>{const e=document.createElement("div");e.className="howManyChars",e.innerText+="A",document.body.appendChild(e);const i=e.clientHeight;for(let i=0;i<t-1;i++)e.innerText+="A";let n=1;for(let t=0;t<500&&(e.style.fontSize=n+"px",!(e.clientHeight>i));t++)n+=.25;const s=document.querySelector(".howManyChars");return s&&s.remove(),n},this.div=t}enable(){this.div.style.display="block"}disable(){this.div.style.display="none"}render(t,e){let i="";for(let n=0;n<t.length;n++){n>0&&n%e==0&&(i+="\n");const s=t[n].calculateLuminance();i+=this.luminanceToAsciiChar(s/255)}this.div.innerText=i}onResize(t){const e=this.getFontSizeToFitScreen(t);this.div.style.fontSize=e+"px",this.div.style.lineHeight=.6*e+"px"}luminanceToAsciiChar(t){let e=52*t*1.2;return e>51&&(e=51)," `,-_~:;!+ilI?][}{1)(\\/tfjrxnuvczmwqpdbkhao#MW&8%B@$".charAt(e)}}},186:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultRenderer=void 0,e.DefaultRenderer=class{constructor(t){this.canvas=t,this.context=this.canvas.getContext("2d")}enable(){this.canvas.style.display="block"}disable(){this.canvas.style.display="none"}render(t,e){let i=Math.ceil(this.context.canvas.width/e),n=0,s=0;for(let r=0;r<t.length;r++)this.context.fillStyle=`rgb(${t[r].r},${t[r].g},${t[r].b})`,this.context.fillRect(n*i,s*i,i,i),n+=1,n>=e&&(n=0,s+=1)}onResize(t){this.context.canvas.width=window.innerWidth,this.context.canvas.height=window.innerHeight}}},79:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vector3d=void 0;class i{constructor(t,e,i){this.x=t,this.y=e,this.z=i}getIntersectionPointWithTriangle(t,e){let i=t[0],n=t[1],s=t[2],r=n.subtract(i),o=s.subtract(i),h=r.crossProduct(o),l=h.dotProduct(this);if(Math.abs(l)<1e-5)return null;let a=-h.dotProduct(i);var c=-(h.dotProduct(e)+a)/l;if(c<0)return null;let d,g=e.add(this.scale(c)),u=n.subtract(i),p=g.subtract(i);if(d=u.crossProduct(p),h.dotProduct(d)<0)return null;let w=s.subtract(n),m=g.subtract(n);if(d=w.crossProduct(m),h.dotProduct(d)<0)return null;let x=i.subtract(s),y=g.subtract(s);return d=x.crossProduct(y),h.dotProduct(d)<0?null:g}getAngleToOtherVector(t){return this.dotProduct(t)/this.getDistanceFromOrigin()/t.getDistanceFromOrigin()*90}crossProduct(t){return new i(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}getDistanceFromOrigin(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getDistanceFromOtherVector(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2)+Math.pow(t.z-this.z,2))}subtract(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}scale(t){return new i(this.x*t,this.y*t,this.z*t)}isAtSamePlaceAs(t){return this.getDistanceFromOtherVector(t)<1e-4}getAngleToTriangle(t){const e=t[1].subtract(t[0]),n=t[2].subtract(t[0]),s=new i(e.y*n.z-e.z*n.y,e.z*n.x-e.x*n.z,e.x*n.y-e.y*n.x);return this.getAngleToOtherVector(s)}}e.Vector3d=i},185:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getConfig=e.generateSphere=e.generatePyramid=e.generateCube=void 0;const n=i(719),s=i(79);e.generatePyramid=t=>{const e=[];e.push([new s.Vector3d(-1*t,1*t,-1*t),new s.Vector3d(1*t,1*t,-1*t),new s.Vector3d(0*t,-1*t,0*t)]),e.push([new s.Vector3d(-1*t,1*t,-1*t),new s.Vector3d(-1*t,1*t,1*t),new s.Vector3d(0*t,-1*t,0*t)]),e.push([new s.Vector3d(1*t,1*t,-1*t),new s.Vector3d(1*t,1*t,1*t),new s.Vector3d(0*t,-1*t,0*t)]),e.push([new s.Vector3d(-1*t,1*t,1*t),new s.Vector3d(1*t,1*t,1*t),new s.Vector3d(0*t,-1*t,0*t)]),e.push([new s.Vector3d(1*t,1*t,-1*t),new s.Vector3d(1*t,1*t,1*t),new s.Vector3d(-1*t,1*t,1*t)]),e.push([new s.Vector3d(-1*t,1*t,1*t),new s.Vector3d(-1*t,1*t,-1*t),new s.Vector3d(1*t,1*t,-1*t)]);const i=new s.Vector3d(0,0,0),r=new s.Vector3d(0,0,0),o={r:255*Math.sqrt(Math.random()),g:255*Math.sqrt(Math.random()),b:255*Math.sqrt(Math.random())};return new n.Object3d(e,i,r,o)},e.generateCube=t=>{const e=[];e.push([new s.Vector3d(-1*t,-1*t,-1*t),new s.Vector3d(-1*t,1*t,-1*t),new s.Vector3d(1*t,-1*t,-1*t)]),e.push([new s.Vector3d(-1*t,1*t,-1*t),new s.Vector3d(1*t,1*t,-1*t),new s.Vector3d(1*t,-1*t,-1*t)]),e.push([new s.Vector3d(-1*t,-1*t,1*t),new s.Vector3d(-1*t,1*t,1*t),new s.Vector3d(1*t,-1*t,1*t)]),e.push([new s.Vector3d(-1*t,1*t,1*t),new s.Vector3d(1*t,1*t,1*t),new s.Vector3d(1*t,-1*t,1*t)]),e.push([new s.Vector3d(-1*t,-1*t,-1*t),new s.Vector3d(-1*t,1*t,-1*t),new s.Vector3d(-1*t,1*t,1*t)]),e.push([new s.Vector3d(-1*t,-1*t,-1*t),new s.Vector3d(-1*t,-1*t,1*t),new s.Vector3d(-1*t,1*t,1*t)]),e.push([new s.Vector3d(1*t,-1*t,-1*t),new s.Vector3d(1*t,1*t,-1*t),new s.Vector3d(1*t,1*t,1*t)]),e.push([new s.Vector3d(1*t,-1*t,-1*t),new s.Vector3d(1*t,-1*t,1*t),new s.Vector3d(1*t,1*t,1*t)]),e.push([new s.Vector3d(-1*t,-1*t,-1*t),new s.Vector3d(1*t,-1*t,-1*t),new s.Vector3d(1*t,-1*t,1*t)]),e.push([new s.Vector3d(-1*t,-1*t,-1*t),new s.Vector3d(-1*t,-1*t,1*t),new s.Vector3d(1*t,-1*t,1*t)]),e.push([new s.Vector3d(-1*t,1*t,-1*t),new s.Vector3d(1*t,1*t,-1*t),new s.Vector3d(1*t,1*t,1*t)]),e.push([new s.Vector3d(-1*t,1*t,-1*t),new s.Vector3d(-1*t,1*t,1*t),new s.Vector3d(1*t,1*t,1*t)]);const i=new s.Vector3d(0,0,0),r=new s.Vector3d(0,0,0),o={r:255*Math.sqrt(Math.random()),g:255*Math.sqrt(Math.random()),b:255*Math.sqrt(Math.random())};return new n.Object3d(e,i,r,o)},e.generateSphere=(t,e,i)=>{const r=[],o=Math.PI;for(let n=0;n<=i;n++){const h=n*o/i,l=Math.sin(h),a=Math.cos(h);for(let i=0;i<=e;i++){const n=2*i*o/e,h=Math.sin(n),c=Math.cos(n)*l,d=a,g=h*l,u=new s.Vector3d(t*c,t*d,t*g);r.push(u)}}const h=[];for(let t=0;t<i;t++)for(let i=0;i<e;i++){const n=t*(e+1)+i,s=n+e+1;h.push([r[n],r[s],r[n+1]]),h.push([r[s],r[s+1],r[n+1]])}const l=new s.Vector3d(0,0,0),a=new s.Vector3d(0,0,0),c={r:255*Math.sqrt(Math.random()),g:255*Math.sqrt(Math.random()),b:255*Math.sqrt(Math.random())};return new n.Object3d(h,l,a,c)},e.getConfig=()=>{const t=document.getElementById("ascii").checked,e=document.getElementById("optimization").checked,i=parseInt(document.getElementById("multisampling").value),n=document.getElementById("lightLeft").checked,s=document.getElementById("lightTop").checked,r=document.getElementById("lightRight").checked,o=document.getElementById("lightBottom").checked,h=window.innerHeight/window.innerWidth,l=parseInt(document.getElementById("resolution").value);return{width:l,height:Math.ceil(l*h),multisampling:i,optimization:e,renderer:t?"ascii":"default",lightLeft:n,lightTop:s,lightRight:r,lightBottom:o}}}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}(()=>{const t=i(180),e=i(79),n=i(185),s=i(929),r=i(186),o=i(768);let h;function l(){h&&(h.loadConfig((0,n.getConfig)()),h.onResize())}window.addEventListener("load",(function(i){!function(){const i=new t.RayCastingEngine,a=(0,n.generatePyramid)(100);a.position=new e.Vector3d(100,-40,200),i.addObject(a);const c=(0,n.generateCube)(150);c.position=new e.Vector3d(-400,-40,500),i.addObject(c);const d=(0,n.generateCube)(80);d.position=new e.Vector3d(-40,-150,300),i.addObject(d);const g=(0,n.generatePyramid)(120);g.position=new e.Vector3d(0,200,400),i.addObject(g),i.addLight({position:new e.Vector3d(205,0,0),intensity:2,enabled:!0}),i.addLight({position:new e.Vector3d(0,-200,0),intensity:2,enabled:!1}),i.addLight({position:new e.Vector3d(-200,0,100),intensity:3,enabled:!1}),i.addLight({position:new e.Vector3d(0,200,50),intensity:4,enabled:!1}),h=new s.RayCastingJs(i,(0,n.getConfig)()),h.addRenderer(new r.DefaultRenderer(document.getElementById("renderhere")),"default"),h.addRenderer(new o.AsciiRenderer(document.getElementById("renderasciihere")),"ascii"),l();const u=()=>{h.update(),h.draw(),document.getElementById("fps").innerText=h.getFps().toString(),window.requestAnimationFrame(u)};window.requestAnimationFrame(u)}()})),window.onresize=()=>{l()},document.querySelectorAll("#sidemenu input, #sidemenu select").forEach((t=>{t.addEventListener("change",(function(t){h.loadConfig((0,n.getConfig)())}))}))})()})();