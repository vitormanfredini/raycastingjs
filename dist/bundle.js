(()=>{"use strict";var t={719:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Object3d=void 0;const s=i(79);e.Object3d=class{constructor(t,e,i,s){this.trianglesOriginal=t,this.triangles=this.copyTriangles(t),this.position=e,this.rotation=i,this.color=s}copyTriangles(t){let e=[];for(let i=0;i<t.length;i++){let n=[];for(let e=0;e<t[i].length;e++)n.push(new s.Vector3d(t[i][e].x,t[i][e].y,t[i][e].z));e.push(n)}return e}update(){this.triangles=this.copyTriangles(this.trianglesOriginal),this.rotate(),this.translate()}rotate(){let t=this.rotation.y,e=this.rotation.x,i=this.rotation.z;var s=Math.cos(i),n=Math.sin(i),r=Math.cos(t),o=Math.sin(t),h=Math.cos(e),l=Math.sin(e),a=s*r,c=s*o*l-n*h,d=s*o*h+n*l,u=n*r,g=n*o*l+s*h,w=n*o*h-s*l,p=-o,x=r*l,m=r*h;for(let t=0;t<this.triangles.length;t++)for(let e=0;e<this.triangles[t].length;e++){var y=this.triangles[t][e].x,b=this.triangles[t][e].y,V=this.triangles[t][e].z;this.triangles[t][e].x=a*y+c*b+d*V,this.triangles[t][e].y=u*y+g*b+w*V,this.triangles[t][e].z=p*y+x*b+m*V}}translate(){for(let t=0;t<this.triangles.length;t++)for(let e=0;e<this.triangles[t].length;e++)this.triangles[t][e]=this.translate3dPoint(this.triangles[t][e],this.position)}translate3dPoint(t,e){return t.x+=e.x,t.y+=e.y,t.z+=e.z,t}}},943:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Pixel=void 0;class i{constructor(t,e,i){this.r=t,this.g=e,this.b=i,this.indexFirstObjectHit=-1,this.indexFirstTriangleHit=-1,this.allSamplesHitSameObject=!1}copy(){let t=new i(this.r,this.g,this.b);return t.indexFirstObjectHit=this.indexFirstObjectHit,t.indexFirstTriangleHit=this.indexFirstTriangleHit,t.allSamplesHitSameObject=this.allSamplesHitSameObject,t}isEqual(t){return null!==t&&this.r==t.r&&this.g==t.g&&this.b==t.b}calculateLuminance(){return.299*this.r+.587*this.g+.114*this.b}}e.Pixel=i},180:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RayCastingEngine=void 0;const s=i(185),n=i(943),r=i(79);e.RayCastingEngine=class{constructor(){this.ascii=!1,this.width=1,this.height=1,this.multisampling=1,this.optimization=!1,this.objects=[],this.lights=[],this.pixels=[],this.pixelsLastFrame=[],this.asciiFontSize=1,this.lastWindowWidth=1,this.lastWindowHeight=1,this.povDistance=1,this.povDistance=this.width/3,this.lastFrameMs=Date.now()}loadConfig(t){const e=this.width!=t.width||this.height!=t.height,i=window.innerWidth!=this.lastWindowWidth||window.innerHeight!=this.lastWindowHeight;if(e||i){this.width=t.width,this.height=t.height,this.povDistance=this.width/3,this.asciiFontSize=(0,s.getFontSizeToFitScreen)(this.width);const e=document.getElementById("renderasciihere");e.style.fontSize=this.asciiFontSize+"px",e.style.lineHeight=.6*this.asciiFontSize+"px",this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.pixels=new Array(this.width*this.height).fill(null),this.pixelsLastFrame=new Array(this.width*this.height).fill(null)}this.multisampling=t.multisampling,this.optimization=t.optimization,this.ascii=t.ascii}getEllapsedMsSinceLastFrame(){const t=Date.now(),e=t-this.lastFrameMs;return this.lastFrameMs=t,e}addObject(t){this.objects.push(t)}addLight(t){this.lights.push(t)}update(t){this.savePixelsFromLastFrame(),this.pixels.fill(null);for(let e=0;e<this.objects.length;e++)0==e?this.objects[e].rotation.y+=.0023*t:1==e?(this.objects[e].rotation.x+=.0041*t,this.objects[e].rotation.z+=.027*t):(this.objects[e].rotation.z-=.0043*t,this.objects[e].rotation.y+=.0028*t),this.objects[e].update();for(let t=0;t<this.height;t+=2)for(let e=t%4==0?0:1;e<this.width;e+=2){let i=this.coordsToIndex(e,t);this.pixels[i]=this.calculatePixelWithMultisampling(e,t,this.multisampling)}for(let t=0;t<this.height;t+=1)for(let e=0;e<this.width;e+=1){let i=this.coordsToIndex(e,t);null===this.pixels[i]&&(this.optimization&&(this.pixels[i]=this.calculatePixelWithInterpolation(e,t,0)),null===this.pixels[i]&&(this.pixels[i]=this.calculatePixelWithMultisampling(e,t,this.multisampling)))}}savePixelsFromLastFrame(){for(let t=0;t<this.pixels.length;t++){const e=this.pixels[t];if(null===e)break;this.pixelsLastFrame[t]=e.copy()}}coordsToIndex(t,e){return e*this.width+t}getPixel(t,e){return this.pixels[this.coordsToIndex(t,e)]}getPixelLastFrame(t,e){return this.pixelsLastFrame[this.coordsToIndex(t,e)]}calculatePixelWithInterpolation(t,e,i){if(t==this.width-1||e==this.height-1||0==t||0==e)return null;const s=[0,1,2];s.includes(i)||(console.log("Interpolation can only be calculated with options "+s.join(", ")+"samples. Using left and right as fallback."),i=0);const r=[];0!=i&&2!=i||(r.push([t+1,e]),r.push([t-1,e])),1!=i&&2!=i||(r.push([t,e+1]),r.push([t,e-1]));const o=new n.Pixel(0,0,0),h=[],l=[];for(let t of r){let e=this.coordsToIndex(t[0],t[1]);if(null===this.pixels[e])return null;if(!this.pixels[e].allSamplesHitSameObject)return null;h.push(this.pixels[e].indexFirstObjectHit),l.push(this.pixels[e].indexFirstTriangleHit),o.r+=this.pixels[e].r/r.length,o.g+=this.pixels[e].g/r.length,o.b+=this.pixels[e].b/r.length}const a=h.every(((t,e,i)=>t===i[0])),c=l.every(((t,e,i)=>t===i[0]));return a&&c?o:null}calculatePixelWithMultisampling(t,e,i){let s=[1,2,4,8];if(s.includes(i)||(console.log("Multisampling can only be calculated with "+s.join(", ")+"samples. Using no-multisampling as fallback."),i=1),1==i){const i=this._calculatePixel(t,e);return i.allSamplesHitSameObject=!0,i}let r=[{x:-.25,y:-.25},{x:.25,y:.25}];i>=4&&(r.push({x:-.25,y:.25}),r.push({x:.25,y:-.25})),i>=8&&(r.push({x:-.5,y:.5}),r.push({x:.5,y:-.5}));const o=new n.Pixel(0,0,0),h=[],l=[];for(let i of r){let s=this._calculatePixel(t+i.x,e+i.y);o.r+=s.r/r.length,o.g+=s.g/r.length,o.b+=s.b/r.length,h.push(s.indexFirstObjectHit),l.push(s.indexFirstTriangleHit)}let a=h.every(((t,e,i)=>t===i[0])),c=l.every(((t,e,i)=>t===i[0]));return o.allSamplesHitSameObject=a&&c,o.indexFirstObjectHit=h[0],o.indexFirstTriangleHit=l[0],o}_calculatePixel(t,e){let i=new r.Vector3d(t-this.width/2,e-this.height/2,this.povDistance),s=new r.Vector3d(0,0,0),o=this.getIntersectionsWithObjects(s,i.subtract(s));const h=this.getClosestIntersection(o);if(null===h)return new n.Pixel(0,0,0);const l=h.point.scale(1),a=h.triangle;let c=[];this.lights.forEach((t=>{let e=l.subtract(t.position),i=this.getIntersectionsWithObjects(t.position,e),s=this.getClosestIntersection(i);if(null!==s&&s.point.isAtSamePlaceAs(l)){let i=e.getAngleToTriangle(a);c.push({angle:i,intensity:t.intensity})}}));let d=1;c.forEach((t=>{let e=t.angle;e=Math.abs(e),e>90&&(e=90-(e-90)),d+=e/90*t.intensity}));const u=this.objects[h.objectIndex].color,g=new n.Pixel(u.r/(h.distance/50)*d,u.g/(h.distance/50)*d,u.b/(h.distance/50)*d);return g.indexFirstObjectHit=h.objectIndex,g.indexFirstTriangleHit=h.triangleIndex,g}getClosestIntersection(t){let e=1/0,i=null;return t.forEach(((t,s)=>{t.distance<e&&(i=t,e=t.distance)})),i}getIntersectionsWithObjects(t,e){let i=[];return this.objects.forEach(((s,n)=>{s.triangles.forEach(((s,r)=>{let o=e.getIntersectionPointWithTriangle(s,t);null!==o&&i.push({point:o,distance:o.getDistanceFromOtherVector(t),objectIndex:n,triangle:s,triangleIndex:r})}))})),i}}},929:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RayCastingJs=void 0,e.RayCastingJs=class{constructor(t,e,i){this.deltaTimeHistory=[],this.context=t,this.asciiElement=e,this.engine=i,this.lastFrameMilliseconds=Date.now()}update(){this.context.canvas.width=window.innerWidth,this.context.canvas.height=window.innerHeight;const t=Date.now(),e=t-this.lastFrameMilliseconds;this.addDeltaTimeToHistory(e),this.engine.update(e/(1e3/60)),this.lastFrameMilliseconds=t}draw(){this.engine.ascii?this.drawAscii():this.drawVirtualPixels()}addDeltaTimeToHistory(t){this.deltaTimeHistory.length>=3&&this.deltaTimeHistory.shift(),this.deltaTimeHistory.push(t)}getFps(){const t=this.deltaTimeHistory.reduce(((t,e)=>t+e),0)/this.deltaTimeHistory.length;return Math.round(1e3/t)}drawVirtualPixels(){let t=this.context.canvas.width/this.engine.width;for(let e=0;e<this.engine.height;e++)for(let i=0;i<this.engine.width;i++){const s=this.engine.getPixel(i,e);this.drawVirtualPixel(Math.floor(i*t),Math.floor(e*t),Math.ceil(t),s)}}drawAscii(){let t="";for(let e=0;e<this.engine.height;e++){for(let i=0;i<this.engine.width;i++){const s=this.engine.getPixel(i,e).calculateLuminance();t+=this.luminanceToAsciiChar(s/255)}t+="\n"}this.asciiElement.innerText=t}luminanceToAsciiChar(t){let e=52*t*1.2;return e>51&&(e=51)," `,-_~:;!+ilI?][}{1)(\\/tfjrxnuvczmwqpdbkhao#MW&8%B@$".charAt(e)}drawVirtualPixel(t,e,i,s){this.context.fillStyle=`rgb(${s.r},${s.g},${s.b})`,this.context.fillRect(t,e,i,i)}}},79:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vector3d=void 0;class i{constructor(t,e,i){this.x=t,this.y=e,this.z=i}getIntersectionPointWithTriangle(t,e){let i=t[0],s=t[1],n=t[2],r=s.subtract(i),o=n.subtract(i),h=r.crossProduct(o),l=h.dotProduct(this);if(Math.abs(l)<1e-5)return null;let a=-h.dotProduct(i);var c=-(h.dotProduct(e)+a)/l;if(c<0)return null;let d,u=e.add(this.scale(c)),g=s.subtract(i),w=u.subtract(i);if(d=g.crossProduct(w),h.dotProduct(d)<0)return null;let p=n.subtract(s),x=u.subtract(s);if(d=p.crossProduct(x),h.dotProduct(d)<0)return null;let m=i.subtract(n),y=u.subtract(n);return d=m.crossProduct(y),h.dotProduct(d)<0?null:u}getAngleToOtherVector(t){return this.dotProduct(t)/this.getDistanceFromOrigin()/t.getDistanceFromOrigin()*90}crossProduct(t){return new i(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}getDistanceFromOrigin(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getDistanceFromOtherVector(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2)+Math.pow(t.z-this.z,2))}subtract(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}scale(t){return new i(this.x*t,this.y*t,this.z*t)}isAtSamePlaceAs(t){return this.getDistanceFromOtherVector(t)<1e-4}getAngleToTriangle(t){const e=t[1].subtract(t[0]),s=t[2].subtract(t[0]),n=new i(e.y*s.z-e.z*s.y,e.z*s.x-e.x*s.z,e.x*s.y-e.y*s.x);return this.getAngleToOtherVector(n)}}e.Vector3d=i},185:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.generateSphere=e.generatePyramid=e.generateCube=e.getFontSizeToFitScreen=void 0;const s=i(719),n=i(79);e.generatePyramid=t=>{const e=[];e.push([new n.Vector3d(-1*t,1*t,-1*t),new n.Vector3d(1*t,1*t,-1*t),new n.Vector3d(0*t,-1*t,0*t)]),e.push([new n.Vector3d(-1*t,1*t,-1*t),new n.Vector3d(-1*t,1*t,1*t),new n.Vector3d(0*t,-1*t,0*t)]),e.push([new n.Vector3d(1*t,1*t,-1*t),new n.Vector3d(1*t,1*t,1*t),new n.Vector3d(0*t,-1*t,0*t)]),e.push([new n.Vector3d(-1*t,1*t,1*t),new n.Vector3d(1*t,1*t,1*t),new n.Vector3d(0*t,-1*t,0*t)]),e.push([new n.Vector3d(1*t,1*t,-1*t),new n.Vector3d(1*t,1*t,1*t),new n.Vector3d(-1*t,1*t,1*t)]),e.push([new n.Vector3d(-1*t,1*t,1*t),new n.Vector3d(-1*t,1*t,-1*t),new n.Vector3d(1*t,1*t,-1*t)]);const i=new n.Vector3d(0,0,0),r=new n.Vector3d(0,0,0),o={r:255*Math.sqrt(Math.random()),g:255*Math.sqrt(Math.random()),b:255*Math.sqrt(Math.random())};return new s.Object3d(e,i,r,o)},e.generateCube=t=>{const e=[];e.push([new n.Vector3d(-1*t,-1*t,-1*t),new n.Vector3d(-1*t,1*t,-1*t),new n.Vector3d(1*t,-1*t,-1*t)]),e.push([new n.Vector3d(-1*t,1*t,-1*t),new n.Vector3d(1*t,1*t,-1*t),new n.Vector3d(1*t,-1*t,-1*t)]),e.push([new n.Vector3d(-1*t,-1*t,1*t),new n.Vector3d(-1*t,1*t,1*t),new n.Vector3d(1*t,-1*t,1*t)]),e.push([new n.Vector3d(-1*t,1*t,1*t),new n.Vector3d(1*t,1*t,1*t),new n.Vector3d(1*t,-1*t,1*t)]),e.push([new n.Vector3d(-1*t,-1*t,-1*t),new n.Vector3d(-1*t,1*t,-1*t),new n.Vector3d(-1*t,1*t,1*t)]),e.push([new n.Vector3d(-1*t,-1*t,-1*t),new n.Vector3d(-1*t,-1*t,1*t),new n.Vector3d(-1*t,1*t,1*t)]),e.push([new n.Vector3d(1*t,-1*t,-1*t),new n.Vector3d(1*t,1*t,-1*t),new n.Vector3d(1*t,1*t,1*t)]),e.push([new n.Vector3d(1*t,-1*t,-1*t),new n.Vector3d(1*t,-1*t,1*t),new n.Vector3d(1*t,1*t,1*t)]),e.push([new n.Vector3d(-1*t,-1*t,-1*t),new n.Vector3d(1*t,-1*t,-1*t),new n.Vector3d(1*t,-1*t,1*t)]),e.push([new n.Vector3d(-1*t,-1*t,-1*t),new n.Vector3d(-1*t,-1*t,1*t),new n.Vector3d(1*t,-1*t,1*t)]),e.push([new n.Vector3d(-1*t,1*t,-1*t),new n.Vector3d(1*t,1*t,-1*t),new n.Vector3d(1*t,1*t,1*t)]),e.push([new n.Vector3d(-1*t,1*t,-1*t),new n.Vector3d(-1*t,1*t,1*t),new n.Vector3d(1*t,1*t,1*t)]);const i=new n.Vector3d(0,0,0),r=new n.Vector3d(0,0,0),o={r:255*Math.sqrt(Math.random()),g:255*Math.sqrt(Math.random()),b:255*Math.sqrt(Math.random())};return new s.Object3d(e,i,r,o)},e.generateSphere=(t,e,i)=>{const r=[],o=Math.PI;for(let s=0;s<=i;s++){const h=s*o/i,l=Math.sin(h),a=Math.cos(h);for(let i=0;i<=e;i++){const s=2*i*o/e,h=Math.sin(s),c=Math.cos(s)*l,d=a,u=h*l,g=new n.Vector3d(t*c,t*d,t*u);r.push(g)}}const h=[];for(let t=0;t<i;t++)for(let i=0;i<e;i++){const s=t*(e+1)+i,n=s+e+1;h.push([r[s],r[n],r[s+1]]),h.push([r[n],r[n+1],r[s+1]])}const l=new n.Vector3d(0,0,0),a=new n.Vector3d(0,0,0),c={r:255*Math.sqrt(Math.random()),g:255*Math.sqrt(Math.random()),b:255*Math.sqrt(Math.random())};return new s.Object3d(h,l,a,c)},e.getFontSizeToFitScreen=t=>{const e=document.createElement("div");e.className="howManyChars",e.innerText+="A",document.body.appendChild(e);const i=e.clientHeight;for(let i=0;i<t-1;i++)e.innerText+="A";let s=1;for(let t=0;t<500&&(e.style.fontSize=s+"px",!(e.clientHeight>i));t++)s+=.25;const n=document.querySelector(".howManyChars");return n&&n.remove(),s}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}(()=>{const t=i(180),e=i(79),s=i(185),n=i(929);let r;window.addEventListener("load",(function(i){!function(){const i=new t.RayCastingEngine,o=(0,s.generatePyramid)(100);o.position=new e.Vector3d(100,-40,200),i.addObject(o);const h=(0,s.generateCube)(150);h.position=new e.Vector3d(-400,-40,500),i.addObject(h);const l=(0,s.generateCube)(80);l.position=new e.Vector3d(-40,-150,300),i.addObject(l);const a=(0,s.generatePyramid)(120);a.position=new e.Vector3d(0,200,400),i.addObject(a),i.addLight({position:new e.Vector3d(205,0,0),intensity:2}),r=new n.RayCastingJs(document.getElementById("renderhere").getContext("2d"),document.getElementById("renderasciihere"),i);const c=()=>{const t=document.getElementById("ascii").checked,e=document.getElementById("optimization").checked,i=parseInt(document.getElementById("multisampling").value),s=window.innerHeight/window.innerWidth,n=parseInt(document.getElementById("resolution").value),o=Math.ceil(n*s);document.getElementById("renderhere").style.display=t?"none":"block",document.getElementById("renderasciihere").style.display=t?"block":"none",r.engine.loadConfig({width:n,height:o,multisampling:i,optimization:e,ascii:t}),r.update(),r.draw(),document.getElementById("fps").innerText=r.getFps().toString(),window.requestAnimationFrame(c)};window.requestAnimationFrame(c)}()}))})()})();